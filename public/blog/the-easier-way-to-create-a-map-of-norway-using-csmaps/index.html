<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="description" content="//localhost:1313/">
    <meta name="keywords" content="personal, science">

    <meta property="og:site_name" content="Kejun Albert Ying">
    <meta property="og:title" content="Kejun Albert Ying">
    <meta property="og:description" content="The Easier Way to Create a Map of Norway Using {csmaps}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="//localhost:1313/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    <meta property="og:image" content="//localhost:1313/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="//localhost:1313/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">
    <meta name="twitter:image" content="//localhost:1313/">

    
    <link rel="stylesheet" type="text/css" href="//localhost:1313/css/style.css">
    
    
    
        
        <link rel="stylesheet" href="/custom_style.css" integrity="">
    

    <link rel="stylesheet" href="https://use.typekit.net/jxt2fnp.css"> 
    <link rel="stylesheet" href="https://use.typekit.net/uwd7war.css"> 
    <link href="https://fonts.cdnfonts.com/css/cooper-hewitt" rel="stylesheet">
    
    
        <meta name="description" content="Kejun (Albert) Ying&#39;s personal website">
    

    
        
            <link rel="shortcut icon" href="/Albert_headshot.jpg">
        
    

    
    
    
    
    
    <title>the easier way to create a map of norway using {csmaps} | kejun albert ying</title>
</head><body><div id="top-stripe"></div><div id="content">

    <div class="article-nav-outer">
        <div class="article-nav-inner">
            <a class="internal" hyphens="none" href='/blog'>← back to blog</a>
        </div>
    </div>

<h2 class="article-title">The Easier Way to Create a Map of Norway Using {csmaps}</h2>
<div id="doc">
    <div class="hanging-subtitle">
        
                
        
            
                <p>24 August 2021</p>
            
        
    </div>
<style type="text/css">
p.stand-out-paragraph code {
  background-color: #93b8c8;
}
</style>
<p class="stand-out-paragraph" 
     
        style="background-color: #acc8d4"
    >
    As of March 2023 <code>{fhimaps}</code> and <code>{splmaps}</code> are no longer supported due to budget cuts at the institution supporting them. The amazing developers (led by <a href="https://www.rwhite.no">Richard Aubrey White</a> and <a href="https://andreaczhang.github.io">Chi Zhang</a>) have moved the data and functionality to a new package called <code>{csmaps}</code>. The code below is updated to reflect the changes.
</p>
<p>Every now and then you discover a discover a much simpler solution to a problem you spent a lot of time solving. This recently happened to me on the topic of creating a map of Norway in R. In this post, I want to go through the process of what I learned.</p>
<p>Previously, I used a JSON file and the <code>{geojsonio}</code> package to create a map of Norway and its fylker (counties) in particular. This was a very flexible and robust way of going about this, but also quite cumbersome. This method relies on a high-quality JSON file, meaning, a file that is detailed enough to display everything nicely, but not too detailed that it takes a ton of time and computing power to create a single plot. While I&rsquo;ll still use this method if I need to create a map for places other than Norway, I think I&rsquo;ve found a better and easier solution for plotting Norway and the fylker and kommuner in the <a href="https://www.csids.no/csmaps/"><code>{csmaps}</code></a> package.</p>
<div class="sidenote" >The group has <a href="https://www.csids.no">a bunch of packages</a> for data science within public health</div>
<p>The <code>{csmaps}</code> package is created by the <a href="https://www.csids.no"><em>Consortium for Statistics in Disease Surveillance</em></a> team. It&rsquo;s part of a series of packages (which they refer to as the &ldquo;csverse&rdquo;), which includes a package containing basic health surveillance data (<a href="https://www.csids.no/csdata/"><code>{csdata}</code></a>), one for real-time analysis in disease surveillance (<a href="https://www.csids.no/sc9/"><code>{sc9}</code></a>) and a few more. Here I&rsquo;ll dive into the <code>{csmaps}</code> package with some help from the <code>{csdata}</code> package. I&rsquo;ll also use the <code>{ggmap}</code> package to help with some other data and plotting. It&rsquo;s perhaps important to note that <code>{ggmap}</code> does contain a map of Norway as a whole, but not of the fylker and kommuner (municipalities), hence the usefulness of the <code>{csmaps}</code> package, which contains both. I&rsquo;ll also use <code>{tidyverse}</code> and <code>{ggtext}</code> as I always do. I won&rsquo;t load <code>{csmaps}</code> with the <code>library()</code> function, but will use the <code>::</code> operator instead since it&rsquo;ll make it easier to navigate the different datasets included.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tidyverse)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(csmaps)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggtext)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggmap)
</span></span></code></pre></div><p>So let&rsquo;s have a look at what&rsquo;s included. You&rsquo;ll see that nearly all maps come in either a <code>data.table</code> format or an <code>sf</code> format. Here I&rsquo;ll use only the data frames, since they&rsquo;re a lot easier to work with. The maps in <code>sf</code> format can be useful elsewhere, but I think for most purposes it&rsquo;s easier and more intuitive to work with data frames.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">data</span>(package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;csmaps&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pluck</span>(<span style="color:#e6db74">&#34;results&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">as_tibble</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(Item, Title) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">print</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>)
</span></span></code></pre></div><p>A comprehensive version of this list is also included in the <a href="https://www.csids.no/csmaps/reference/index.html">reference</a> for this package.</p>
<p>So let&rsquo;s have a look at one of those maps. For instance the one with the new fylker from 2020 with an inset of Oslo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>map_df <span style="color:#f92672">&lt;-</span> nor_county_map_b2020_insert_oslo_dt <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">glimpse</span>()
</span></span></code></pre></div><pre><code>Rows: 4,493
Columns: 5
$ long          &lt;dbl&gt; 5.823860, 5.969413, 6.183042, 6.302433, 6.538059, 6.6935…
$ lat           &lt;dbl&gt; 59.64576, 59.57897, 59.58607, 59.76743, 59.84285, 59.822…
$ order         &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ group         &lt;fct&gt; 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11.1, 11…
$ location_code &lt;chr&gt; &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_nor11&quot;, &quot;county_…
</code></pre>
<p>Immediately you can see that there&rsquo;s a lot of rows, each representing a point on the map. A data frame with a larger number of rows would be more detailed (i.e. less straight lines, more detail in curvatures of borders etc.). Let&rsquo;s create a very simple map. We&rsquo;ll use the <code>geom_polygon</code> to turn our data frame into a map. The location of the points are given in longitudes and latitudes (like x- and y-coordinates), the group serves to make sure lines are drawn correctly (try running the code below without <code>group = group</code> and see what happens). The <code>location_code</code> denotes the county number (which isn&rsquo;t from 1 to 11, but instead uses some other standard format matching numbers in other government datasets). Let&rsquo;s see the simplest map:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(map_df, <span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>  x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat,
</span></span><span style="display:flex;"><span>  group <span style="color:#f92672">=</span> group, fill <span style="color:#f92672">=</span> location_code
</span></span><span style="display:flex;"><span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>()
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/minimal-plot-1.png" width="768" />
<p>Now let&rsquo;s convert the awkward county numbers to the actual names of the fylker. The <code>{csdata}</code> package has a data frame with codes and names for all the kommuner, fylker, and even regions (Øst, Vest, Nord-Norge etc.). We&rsquo;re only interested in the fylker here, so we&rsquo;ll select the unique location codes and the corresponding location names.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>county_names <span style="color:#f92672">&lt;-</span> csdata<span style="color:#f92672">::</span><span style="color:#a6e22e">nor_locations_names</span>(border <span style="color:#f92672">=</span> <span style="color:#ae81ff">2020</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">str_detect</span>(location_code, <span style="color:#e6db74">&#34;^county&#34;</span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">distinct</span>(location_code, location_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(county_names)
</span></span></code></pre></div><pre><code>    location_code        location_name
 1:  county_nor42                Agder
 2:  county_nor34            Innlandet
 3:  county_nor15      Møre og Romsdal
 4:  county_nor18             Nordland
 5:  county_nor03                 Oslo
 6:  county_nor11             Rogaland
 7:  county_nor54    Troms og Finnmark
 8:  county_nor50            Trøndelag
 9:  county_nor38 Vestfold og Telemark
10:  county_nor46             Vestland
11:  county_nor30                Viken
</code></pre>
<div class="sidenote" >The <a href="https://github.com/thomasp85/scico"><code>{scico}</code></a> package contains a collection of color palettes that are great for accessibility</div>
<p>Now let&rsquo;s also create a nice color palette to give each fylke a nicer color than the default ggplot colors. We&rsquo;ll create a named vector to match each fylke with a color from the <em>batlow</em> palette by <a href="https://www.fabiocrameri.ch/colourmaps/">Fabio Crameri</a> implemented in the <code>{scico}</code> package.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>county_colors <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">setNames</span>(
</span></span><span style="display:flex;"><span>  scico<span style="color:#f92672">::</span><span style="color:#a6e22e">scico</span>(
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(county_names),
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;batlow&#34;</span>
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>  nm <span style="color:#f92672">=</span> county_names<span style="color:#f92672">$</span>location_name
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Let&rsquo;s see what we can make now. We&rsquo;ll add the county names to the large data frame containing the longitudes and latitudes and then create a plot again. I&rsquo;ll also add some other style elements, such as a labels to the x- and y-axes, circles instead of squares for the legend and a map projection. For Norway especially I think a conic map projection works well since the northern fylker are so massive and the southern fylker are more dense, so adding a conic projection with a cone tangent of 40 degrees makes it a bit more perceptionally balanced (<code>lat0</code> refers to the cone tangent, the details are complicated but a higher cone tangent results a greater distortion in favor of southern points).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>map_df <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(county_names, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat,
</span></span><span style="display:flex;"><span>    fill <span style="color:#f92672">=</span> location_name, group <span style="color:#f92672">=</span> group
</span></span><span style="display:flex;"><span>  )) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>(key_glyph <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;point&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_x_continuous</span>(
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">label_number</span>(suffix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\u00b0W&#34;</span>)
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_y_continuous</span>(
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">label_number</span>(suffix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\u00b0N&#34;</span>)
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_fill_manual</span>(
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> county_colors,
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(override.aes <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_map</span>(projection <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conic&#34;</span>, lat0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    legend.position <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.9</span>, <span style="color:#ae81ff">0.2</span>),
</span></span><span style="display:flex;"><span>    legend.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>    legend.key.height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;pt&#34;</span>),
</span></span><span style="display:flex;"><span>    legend.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(
</span></span><span style="display:flex;"><span>      fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>,
</span></span><span style="display:flex;"><span>      color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/simple-plot-1.png" width="768" />
<h2 id="norway-with-scandinavia">Norway with Scandinavia</h2>
<p>Sometimes it&rsquo;s useful to plot Norway in geographical context. We can overlay Norway on a map of Scandinavia or Europe to create a more aesthetically pleasing figure that is less scientific but easier to read. For that we&rsquo;ll first extract the longitude and latitude extremities of Norway, so we can easily center Norway on our new map.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;Range across longitude: {str_c(range(map_df$long), collapse = &#39;, &#39;)}&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;Range across latitude: {str_c(range(map_df$lat), collapse = &#39;, &#39;)}&#34;</span>)
</span></span></code></pre></div><pre><code>Range across longitude: 4.64197936086325, 31.0578692314387
Range across latitude: 57.9797576545731, 71.1848833506563
</code></pre>
<p>Let&rsquo;s also combine the map with some actual data. The <code>{csdata}</code> package contains some simple data on age distribution in kommuner and fylker. Let&rsquo;s take the data from the different fylker in the last available year and see what proportion of the total population is younger than 18.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>age_data <span style="color:#f92672">&lt;-</span> csdata<span style="color:#f92672">::</span><span style="color:#a6e22e">nor_population_by_age_cats</span>(
</span></span><span style="display:flex;"><span>  border <span style="color:#f92672">=</span> <span style="color:#ae81ff">2020</span>,
</span></span><span style="display:flex;"><span>  cats <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">18</span>))
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_detect</span>(location_code, <span style="color:#e6db74">&#34;^county&#34;</span>),
</span></span><span style="display:flex;"><span>    calyear <span style="color:#f92672">==</span> <span style="color:#a6e22e">max</span>(calyear)
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pivot_wider</span>(
</span></span><span style="display:flex;"><span>    id_cols <span style="color:#f92672">=</span> location_code,
</span></span><span style="display:flex;"><span>    names_from <span style="color:#f92672">=</span> age, values_from <span style="color:#f92672">=</span> pop_jan1_n
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  janitor<span style="color:#f92672">::</span><span style="color:#a6e22e">clean_names</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rename</span>(age_0_18 <span style="color:#f92672">=</span> x001_018) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(proportion <span style="color:#f92672">=</span> age_0_18 <span style="color:#f92672">/</span> total)
</span></span></code></pre></div><p>Let&rsquo;s create a map without the Oslo inset, combine it with the age distribution data and plot it on top of a map of the world cropped to just Scandinavia. So for this we load another data frame and use <code>left_join</code> to merge the age distribution data into one data frame. The <code>{ggmap}</code> package has a map of the entire world, which we&rsquo;ll use. To avoid awkward overlap, we&rsquo;ll plot everything except Norway from that world map (since we&rsquo;ll have our own better map to use instead). We&rsquo;ll set the <code>fill</code> to proportion of the population under the age of 18 and set similar style elements to make the figure look nicer. I used the extremities we extracted earlier as a guideline, but we can play around with the crop of the map to get something that works best.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>nor_county_map_b2020_default_dt <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(age_data, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat, group <span style="color:#f92672">=</span> group)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#a6e22e">map_data</span>(<span style="color:#e6db74">&#34;world&#34;</span>) <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(region <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Norway&#34;</span>),
</span></span><span style="display:flex;"><span>    fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey80&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>(<span style="color:#a6e22e">aes</span>(fill <span style="color:#f92672">=</span> proportion), key_glyph <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;point&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Proportion of the population younger than 18&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  scico<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_fill_scico</span>(
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;devon&#34;</span>, limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.15</span>, <span style="color:#ae81ff">0.31</span>),
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">percent_format</span>(accuracy <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_colorbar</span>(
</span></span><span style="display:flex;"><span>      title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>, title.hjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>      barwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, barheight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, ticks <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_map</span>(
</span></span><span style="display:flex;"><span>    projection <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conic&#34;</span>, lat0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>    xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-8</span>, <span style="color:#ae81ff">40</span>), ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">70</span>)
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    plot.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(
</span></span><span style="display:flex;"><span>      fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#A2C0F4&#34;</span>,
</span></span><span style="display:flex;"><span>      color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    legend.direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>,
</span></span><span style="display:flex;"><span>    legend.position <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.8</span>, <span style="color:#ae81ff">0.1</span>),
</span></span><span style="display:flex;"><span>    legend.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>),
</span></span><span style="display:flex;"><span>    legend.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/age-plot-1.png" width="768" />
<h2 id="geocoding">Geocoding</h2>
<div class="sidenote"  style="padding-top: 3em;">The Google Maps API requires a personal API key, you can read how to obtain and register an API key <a href="https://github.com/dkahle/ggmap">here</a></div>
<p>The <code>{ggmap}</code> package also has an incredibly useful function called <code>mutate_geocode()</code> which transforms a string with an address or description in character format to longitude and latitude. Since <code>{ggmap}</code> uses the Google Maps API, it works similarly to typing in a description in Google Maps. So an approximation of the location will (most likely) get you the right result (e.g. with &ldquo;Hospital Lillehammer&rdquo;). Note that <code>mutate_geocode</code> uses <code>lon</code> instead of <code>long</code> as column name for longitude. Just to avoid confusion, I&rsquo;ll rename the column to <code>long</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>hospitals_df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(location <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Ullevål Sykehus, Oslo&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Haukeland universitetssjukehus, Bergen&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;St. Olav, Trondheim&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Universitetssykehuset Nord-Norge, Tromsø&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Stavanger Universitetssjukehus&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Sørlandet Hospital Kristiansand&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Hospital Lillehammer&#34;</span>
</span></span><span style="display:flex;"><span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate_geocode</span>(location) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rename</span>(long <span style="color:#f92672">=</span> lon)
</span></span></code></pre></div><p>This is the list of coordinates it gave us:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(hospitals_df)
</span></span></code></pre></div><pre><code># A tibble: 7 × 3
  location                                  long   lat
  &lt;chr&gt;                                    &lt;dbl&gt; &lt;dbl&gt;
1 Ullevål Sykehus, Oslo                    10.7   59.9
2 Haukeland universitetssjukehus, Bergen    5.36  60.4
3 St. Olav, Trondheim                      10.4   63.4
4 Universitetssykehuset Nord-Norge, Tromsø 19.0   69.7
5 Stavanger Universitetssjukehus            5.73  59.0
6 Sørlandet Hospital Kristiansand           7.98  58.2
7 Hospital Lillehammer                     10.5   61.1
</code></pre>
<p>Now let&rsquo;s put these on top of the map. We&rsquo;ll use the same map we used earlier. We&rsquo;ll add the locations using a simple <code>geom_point</code>. This time I&rsquo;ll also add a line from the inset to Oslo&rsquo;s location on the map. The <code>xend</code> and <code>yend</code> coordinates takes some trial-and-error but I think it&rsquo;s worth it. I&rsquo;ll also add labels to each of the points with the help of the <code>{ggrepel}</code> package to illustrate what the points stand for. I suppose usually this is obvious from context, but I just wanted to show how it can be done anyway.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">21</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map_df <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(county_names, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat,
</span></span><span style="display:flex;"><span>    fill <span style="color:#f92672">=</span> location_name, group <span style="color:#f92672">=</span> group
</span></span><span style="display:flex;"><span>  )) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>(key_glyph <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;point&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_segment</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> hospitals_df <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">str_detect</span>(location, <span style="color:#e6db74">&#34;Oslo&#34;</span>)),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat, xend <span style="color:#f92672">=</span> <span style="color:#ae81ff">19.5</span>, yend <span style="color:#f92672">=</span> <span style="color:#ae81ff">62</span>),
</span></span><span style="display:flex;"><span>    inherit.aes <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_point</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> hospitals_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat),
</span></span><span style="display:flex;"><span>    inherit.aes <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
</span></span><span style="display:flex;"><span>    shape <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;firebrick&#34;</span>,
</span></span><span style="display:flex;"><span>    size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  ggrepel<span style="color:#f92672">::</span><span style="color:#a6e22e">geom_label_repel</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> hospitals_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat, label <span style="color:#f92672">=</span> location),
</span></span><span style="display:flex;"><span>    size <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>, label.size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, inherit.aes <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_fill_manual</span>(
</span></span><span style="display:flex;"><span>    values <span style="color:#f92672">=</span> county_colors,
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_legend</span>(override.aes <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>      size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, shape <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>,
</span></span><span style="display:flex;"><span>      color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>
</span></span><span style="display:flex;"><span>    ))
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_map</span>(projection <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conic&#34;</span>, lat0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    legend.position <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.7</span>),
</span></span><span style="display:flex;"><span>    legend.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>),
</span></span><span style="display:flex;"><span>    legend.key.height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;pt&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-w-cities-1.png" width="768" />
<h2 id="combine-the-map-with-other-data">Combine the map with other data</h2>
<p>Let&rsquo;s take it a step further and now look at how we can combine our map with data that didn&rsquo;t come directly from the FHI. Instead I downloaded some data from the Norwegian Statistics Bureau (<a href="https://www.ssb.no">Statistisk sentralbyrå, SSB</a>) on land use in the kommuner (<a href="https://www.ssb.no/en/natur-og-miljo/areal/statistikk/arealbruk-og-arealressurser">link</a>). This came in the form of a semi-colon separated .csv file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>area_use <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_delim</span>(<span style="color:#e6db74">&#34;./data/areal.csv&#34;</span>,
</span></span><span style="display:flex;"><span>  delim <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;;&#34;</span>, skip <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  janitor<span style="color:#f92672">::</span><span style="color:#a6e22e">clean_names</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(area_use)
</span></span></code></pre></div><pre><code># A tibble: 356 × 20
   region   area_2021_residentia…¹ area_2021_recreation…² area_2021_built_up_a…³
   &lt;chr&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
 1 3001 Ha…                   9.61                   1.85                   2.51
 2 3002 Mo…                  10.4                    1.86                   1.59
 3 3003 Sa…                  14.0                    2.95                   3.49
 4 3004 Fr…                  19.9                    5.14                   3.05
 5 3005 Dr…                  18.4                    1.17                   1.26
 6 3006 Ko…                   7.68                   2.23                   2.38
 7 3007 Ri…                  11                      3.99                   4.18
 8 3011 Hv…                   2.31                   5.79                   0.65
 9 3012 Ar…                   0.64                   0.73                   0.8 
10 3013 Ma…                   1.38                   0.58                   1.68
# ℹ 346 more rows
# ℹ abbreviated names: ¹​area_2021_residential_areas,
#   ²​area_2021_recreational_facilities,
#   ³​area_2021_built_up_areas_for_agriculture_and_fishing
# ℹ 16 more variables: area_2021_industrial_commercial_and_service_areas &lt;dbl&gt;,
#   area_2021_education_and_day_care_facilities &lt;dbl&gt;,
#   area_2021_health_and_social_welfare_institutions &lt;dbl&gt;, …
</code></pre>
<p>You can see there&rsquo;s 356 rows, each representing a different kommune in Norway. The columns here represent the surface area (in km<sup>2</sup>) with different designations (e.g. forest, health services, agriculture etc.). All data here is from 2021. Now, kommunes have different sizes, so I want to get the designations of interest as percentages of total area in the kommune. Here I assumed that the sum of all designations is equal to the total size of each kommune. I also want to extract the kommune number, since we&rsquo;ll use that to merge this data frame with the map later. The kommune number needs to be 4 digits, so we need to add a leading 0 in some instances. Then we&rsquo;ll create the <code>location_code</code> column which will match the <code>location_code</code> column in the data frame from <code>{csmaps}</code>. Then we&rsquo;ll calculate the percentage land use for different designations. Here I&rsquo;m just interested in <em>&ldquo;bare rock, gravel, and blockfields&rdquo;</em>, <em>&ldquo;wetland</em>, <em>&ldquo;forest&rdquo;</em>, and <em>&ldquo;Open firm ground&rdquo;</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>area_use <span style="color:#f92672">&lt;-</span> area_use <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(
</span></span><span style="display:flex;"><span>    total_area <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowSums</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">where</span>(is.numeric))),
</span></span><span style="display:flex;"><span>    kommune_code <span style="color:#f92672">=</span> <span style="color:#a6e22e">parse_number</span>(region),
</span></span><span style="display:flex;"><span>    kommune_code <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(kommune_code, digits <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>),
</span></span><span style="display:flex;"><span>    kommune_code <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace_all</span>(kommune_code, <span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;0&#34;</span>),
</span></span><span style="display:flex;"><span>    location_code <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;municip_nor{kommune_code}&#34;</span>),
</span></span><span style="display:flex;"><span>    perc_rocks <span style="color:#f92672">=</span> area_2021_bare_rock_gravel_and_blockfields <span style="color:#f92672">/</span> total_area,
</span></span><span style="display:flex;"><span>    perc_wetland <span style="color:#f92672">=</span> area_2021_wetland <span style="color:#f92672">/</span> total_area,
</span></span><span style="display:flex;"><span>    perc_forest <span style="color:#f92672">=</span> area_2021_forest <span style="color:#f92672">/</span> total_area,
</span></span><span style="display:flex;"><span>    perc_open_ground <span style="color:#f92672">=</span> area_2021_open_firm_ground <span style="color:#f92672">/</span> total_area
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(kommune_code) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">glimpse</span>()
</span></span></code></pre></div><pre><code>Rows: 356
Columns: 27
$ region                                                              &lt;chr&gt; &quot;0…
$ area_2021_residential_areas                                         &lt;dbl&gt; 51…
$ area_2021_recreational_facilities                                   &lt;dbl&gt; 1.…
$ area_2021_built_up_areas_for_agriculture_and_fishing                &lt;dbl&gt; 0.…
$ area_2021_industrial_commercial_and_service_areas                   &lt;dbl&gt; 10…
$ area_2021_education_and_day_care_facilities                         &lt;dbl&gt; 3.…
$ area_2021_health_and_social_welfare_institutions                    &lt;dbl&gt; 1.…
$ area_2021_cultural_and_religious_activities                         &lt;dbl&gt; 0.…
$ area_2021_transport_telecommunications_and_technical_infrastructure &lt;dbl&gt; 36…
$ area_2021_emergency_and_defence_services                            &lt;dbl&gt; 0.…
$ area_2021_green_areas_and_sports_facilities                         &lt;dbl&gt; 9.…
$ area_2021_unclassified_built_up_areas_and_related_land              &lt;dbl&gt; 8.…
$ area_2021_agricultural_land                                         &lt;dbl&gt; 9.…
$ area_2021_forest                                                    &lt;dbl&gt; 27…
$ area_2021_open_firm_ground                                          &lt;dbl&gt; 7.…
$ area_2021_wetland                                                   &lt;dbl&gt; 4.…
$ area_2021_bare_rock_gravel_and_blockfields                          &lt;dbl&gt; 0.…
$ area_2021_permanent_snow_and_glaciers                               &lt;dbl&gt; 0.…
$ area_2021_inland_waters                                             &lt;dbl&gt; 28…
$ area_2021_unclassified_undeveloped_areas                            &lt;dbl&gt; 0,…
$ total_area                                                          &lt;dbl&gt; 45…
$ kommune_code                                                        &lt;chr&gt; &quot;0…
$ location_code                                                       &lt;glue&gt; &quot;…
$ perc_rocks                                                          &lt;dbl&gt; 0.…
$ perc_wetland                                                        &lt;dbl&gt; 0.…
$ perc_forest                                                         &lt;dbl&gt; 0.…
$ perc_open_ground                                                    &lt;dbl&gt; 0.…
</code></pre>
<p>Then the next step is very similar to what we&rsquo;ve done before. We&rsquo;ll use <code>left_join</code> to merge the data frame containing the land use variables with the data frame containing the map with the kommune borders. I want to plot the four designations of interest in one figure, so I&rsquo;ll transform the plot to a long format using <code>pivot_longer</code>. Then I&rsquo;ll create a new label with nicer descriptions of the designations, and then the rest is similar to before. We&rsquo;ll facet the plot based on the designation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>nor_municip_map_b2020_split_dt <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(area_use, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pivot_longer</span>(
</span></span><span style="display:flex;"><span>    cols <span style="color:#f92672">=</span> <span style="color:#a6e22e">starts_with</span>(<span style="color:#e6db74">&#34;perc&#34;</span>),
</span></span><span style="display:flex;"><span>    names_to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;land_type&#34;</span>, values_to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;percentage&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(land_type_label <span style="color:#f92672">=</span> <span style="color:#a6e22e">case_when</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_detect</span>(land_type, <span style="color:#e6db74">&#34;rocks&#34;</span>) <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Bare rock, gravel and rockfields&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_detect</span>(land_type, <span style="color:#e6db74">&#34;wetland&#34;</span>) <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Wetland&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_detect</span>(land_type, <span style="color:#e6db74">&#34;forest&#34;</span>) <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Forest&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">str_detect</span>(land_type, <span style="color:#e6db74">&#34;open_ground&#34;</span>) <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Open firm ground&#34;</span>
</span></span><span style="display:flex;"><span>  )) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat,
</span></span><span style="display:flex;"><span>    group <span style="color:#f92672">=</span> group, fill <span style="color:#f92672">=</span> percentage
</span></span><span style="display:flex;"><span>  )) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Percentage&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  scico<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_fill_scico</span>(
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;acton&#34;</span>,
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">label_percent</span>(),
</span></span><span style="display:flex;"><span>    limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_colorbar</span>(
</span></span><span style="display:flex;"><span>      barheight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, barwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>,
</span></span><span style="display:flex;"><span>      ticks <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>,
</span></span><span style="display:flex;"><span>      title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>, title.hjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>land_type_label) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_map</span>(projection <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conic&#34;</span>, lat0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
</span></span><span style="display:flex;"><span>    strip.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_textbox_simple</span>(
</span></span><span style="display:flex;"><span>      size <span style="color:#f92672">=</span> <span style="color:#a6e22e">rel</span>(<span style="color:#ae81ff">1.25</span>), halign <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>      margin <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;pt&#34;</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-kommune-faceted-1.png" width="768" />
<h2 id="oslo">Oslo</h2>
<p>The last thing I want to show is a map of Oslo! <code>{csmaps}</code> contains a detailed map of the bydeler that we will use. Now, these bydeler are again coded and <code>{csdata}</code> (since it&rsquo;s update) now contains a <a href="https://www.csids.no/csmaps/articles/customization.html#add-location-name-for-ward-and-population-for-oslo-map">data frame</a> with the corresponding names for all geography levels (fylker, municipalities, bydeler, etc.). We could get our data from there, but we also need something to visualize so we&rsquo;ll scrape a Wikipedia article for Oslo&rsquo;s bydeler which contains a table with the bydel numbers, the names, and some data we can use for visualization. We&rsquo;ll extract the table from the website using <code>{rvest}</code>, do some data wrangling and prepare it for merging into the data frame with the map. I won&rsquo;t go into the wrangling much here, we&rsquo;re interested mainly in the plotting of the data right now.</p>
<div class="sidenote" >I won&rsquo;t go into much detail on web scraping here, you can see one of the <a href="https://danielroelfs.com/blog/">other posts</a> for more details</div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>bydel_data <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/List_of_boroughs_of_Oslo&#34;</span> <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  rvest<span style="color:#f92672">::</span><span style="color:#a6e22e">read_html</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  rvest<span style="color:#f92672">::</span><span style="color:#a6e22e">html_table</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pluck</span>(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  janitor<span style="color:#f92672">::</span><span style="color:#a6e22e">clean_names</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(
</span></span><span style="display:flex;"><span>    inhabitants <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_remove_all</span>(residents, <span style="color:#e6db74">&#34;[[:blank:]]&#34;</span>),
</span></span><span style="display:flex;"><span>    inhabitants <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(inhabitants),
</span></span><span style="display:flex;"><span>    area <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_remove_all</span>(area, <span style="color:#e6db74">&#34;km2&#34;</span>),
</span></span><span style="display:flex;"><span>    area <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace_all</span>(area, <span style="color:#e6db74">&#34;,&#34;</span>, <span style="color:#e6db74">&#34;.&#34;</span>),
</span></span><span style="display:flex;"><span>    area <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_squish</span>(area),
</span></span><span style="display:flex;"><span>    area <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(area),
</span></span><span style="display:flex;"><span>    pop_density <span style="color:#f92672">=</span> inhabitants <span style="color:#f92672">/</span> area
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">arrange</span>(number) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(
</span></span><span style="display:flex;"><span>    bydel_nr <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(number, digits <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>),
</span></span><span style="display:flex;"><span>    bydel_nr <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace_all</span>(bydel_nr, <span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;0&#34;</span>),
</span></span><span style="display:flex;"><span>    location_code <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;wardoslo_nor0301{bydel_nr}&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(bydel_data)
</span></span></code></pre></div><pre><code># A tibble: 15 × 8
   borough residents  area number inhabitants pop_density bydel_nr location_code
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;glue&gt;       
 1 Gamle … 58 671      7.5      1       58671       7823. 01       wardoslo_nor…
 2 Grüner… 62 423      4.8      2       62423      13005. 02       wardoslo_nor…
 3 Sagene  45 089      3.1      3       45089      14545. 03       wardoslo_nor…
 4 St. Ha… 38 945      3.6      4       38945      10818. 04       wardoslo_nor…
 5 Frogner 59 269      8.3      5       59269       7141. 05       wardoslo_nor…
 6 Ullern  34 596      9.4      6       34596       3680. 06       wardoslo_nor…
 7 Vestre… 50 157     16.6      7       50157       3022. 07       wardoslo_nor…
 8 Nordre… 52 327     13.6      8       52327       3848. 08       wardoslo_nor…
 9 Bjerke  33 422      7.7      9       33422       4341. 09       wardoslo_nor…
10 Grorud  27 707      8.2     10       27707       3379. 10       wardoslo_nor…
11 Stovner 33 316      8.2     11       33316       4063. 11       wardoslo_nor…
12 Alna    49 801     13.7     12       49801       3635. 12       wardoslo_nor…
13 Østens… 50 806     12.2     13       50806       4164. 13       wardoslo_nor…
14 Nordst… 52 459     16.9     14       52459       3104. 14       wardoslo_nor…
15 Søndre… 39 066     18.4     15       39066       2123. 15       wardoslo_nor…
</code></pre>
<p><code>{csmaps}</code> also provides a very useful data frame containing the geographical center or best location to put a label to avoid overlap and make it as clear as possible which label corresponds to which bydel. So we&rsquo;ll merge those two together.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>bydel_centres <span style="color:#f92672">&lt;-</span> oslo_ward_position_geolabels_b2020_default_dt <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inner_join</span>(bydel_data, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>)
</span></span></code></pre></div><p>Then we&rsquo;ll create the final plot. This will be more-or-less identical to what we did before.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>oslo_ward_map_b2020_default_dt <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(bydel_data, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> long, y <span style="color:#f92672">=</span> lat, group <span style="color:#f92672">=</span> group)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>(<span style="color:#a6e22e">aes</span>(color <span style="color:#f92672">=</span> pop_density, fill <span style="color:#f92672">=</span> pop_density)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_label</span>(
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> bydel_centres, <span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> borough, group <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, label.size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;N&lt;sup&gt;o&lt;/sup&gt; of inhabitants per km&lt;sup&gt;2&lt;/sup&gt;&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  scico<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_color_scico</span>(
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;turku&#34;</span>,
</span></span><span style="display:flex;"><span>    limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.5e4</span>),
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;none&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  scico<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_fill_scico</span>(
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;turku&#34;</span>,
</span></span><span style="display:flex;"><span>    limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.5e4</span>),
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span><span style="color:#a6e22e">number_format</span>(),
</span></span><span style="display:flex;"><span>    guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_colorbar</span>(
</span></span><span style="display:flex;"><span>      title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>, title.hjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>      barwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>, barheight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>, ticks <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
</span></span><span style="display:flex;"><span>    legend.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(),
</span></span><span style="display:flex;"><span>    legend.direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/plot-oslo-1.png" width="768" />
<p><strong>BONUS</strong></p>
<p>An example of when you might use the <code>sf</code> data format is in interactive maps. Here&rsquo;s a short example of what that might look like. Here we&rsquo;ll use the <code>{leaflet}</code> package (which is an R wrapper for the homonymous JavaScript library) to create an interactive map where we can zoom and hover on the different fylker. This won&rsquo;t work on printed media, but it might be nice to include in a digital format. You could possibly extract the corresponding HTML and JavaScript code and embed it on a webpage separately.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(leaflet)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map_sf <span style="color:#f92672">&lt;-</span> csmaps<span style="color:#f92672">::</span>nor_county_map_b2020_default_sf <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">left_join</span>(county_names, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;location_code&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>map_sf <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addProviderTiles</span>(providers<span style="color:#f92672">$</span>Esri.WorldStreetMap) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addPolygons</span>(
</span></span><span style="display:flex;"><span>    fillColor <span style="color:#f92672">=</span> <span style="color:#a6e22e">unname</span>(county_colors),
</span></span><span style="display:flex;"><span>    weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>,
</span></span><span style="display:flex;"><span>    opacity <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    fillOpacity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>,
</span></span><span style="display:flex;"><span>    highlightOptions <span style="color:#f92672">=</span> <span style="color:#a6e22e">highlightOptions</span>(
</span></span><span style="display:flex;"><span>      color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#333&#34;</span>, bringToFront <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
</span></span><span style="display:flex;"><span>      weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, opacity <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><iframe seamless src="leafMap.html" width="100%" height="500" frameBorder="0" style="padding-top: 1em;">
</iframe>
<p><strong>EDIT (2022-09-04)</strong>: Updated the blogpost to replace usage of the retiring <code>{fhimaps}</code> and <code>{fhidata}</code> packages with the newer <code>{splmaps}</code> and <code>{spldata}</code> packages from FHI. The <code>{fhidata}</code> package included a dataset on vaccination rates in Norway, but since this isn&rsquo;t incorporated in the new <code>{spldata}</code> package I replaced that plot with a plot about age distribution.
In addition, I also replaced all usage of the NORMENT internal <code>{normentR}</code> package with the <code>{scico}</code> package which is available on CRAN.</p>
<p><strong>EDIT (2023-06-18)</strong>: Updated the blogpost to reflect the deprecation of the <code>{splmaps}</code> and <code>{spldata}</code> packages. Replaced them with the replacement package <code>{csmaps}</code> available on CRAN.</p>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

</div>

        </div>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/foundation.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
<script>
  hljs.highlightAll();
</script>


<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
  MathJax = {
      tex: {
        inlineMath: [ ['$','$'] ]
      }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>


<script src="https://unpkg.com/feather-icons"></script>
<script>
  feather.replace()
</script>

<div id="nav-border" class="container">
    
    <div class="nav-outer">
        <div class="nav-inner">
            
                
                    
                        <a class="internal" hyphens="none" href="/">
                            
                            Home
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/blog">
                            
                            Blog
                        </a>
                    
                
                    
                
                    
                        <a class="internal" hyphens="none" href="/publications">
                            
                            Publications
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/cv">
                            
                            CV
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/about">
                            
                            About
                        </a>
                    
                
            
        </div>
    </div>
    
</div>

</body>
</html>
