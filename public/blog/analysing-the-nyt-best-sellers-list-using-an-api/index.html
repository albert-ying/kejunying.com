<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="description" content="//localhost:1313/">
    <meta name="keywords" content="personal, science">

    <meta property="og:site_name" content="Kejun Albert Ying">
    <meta property="og:title" content="Kejun Albert Ying">
    <meta property="og:description" content="Analysing the NYT Best Sellers list using an API">
    <meta property="og:type" content="website">
    <meta property="og:url" content="//localhost:1313/blog/analysing-the-nyt-best-sellers-list-using-an-api/">
    <meta property="og:image" content="//localhost:1313/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="//localhost:1313/blog/analysing-the-nyt-best-sellers-list-using-an-api/">
    <meta name="twitter:image" content="//localhost:1313/">

    
    <link rel="stylesheet" type="text/css" href="//localhost:1313/css/style.css">
    
    
    
        
        <link rel="stylesheet" href="/custom_style.css" integrity="">
    

    <link rel="stylesheet" href="https://use.typekit.net/jxt2fnp.css"> 
    <link rel="stylesheet" href="https://use.typekit.net/uwd7war.css"> 
    <link href="https://fonts.cdnfonts.com/css/cooper-hewitt" rel="stylesheet">
    
    
        <meta name="description" content="Kejun (Albert) Ying&#39;s personal website">
    

    
        
            <link rel="shortcut icon" href="/Albert_headshot.jpg">
        
    

    
    
    
    
    
    <title>analysing the nyt best sellers list using an api | kejun albert ying</title>
</head><body><div id="top-stripe"></div><div id="content">

    <div class="article-nav-outer">
        <div class="article-nav-inner">
            <a class="internal" hyphens="none" href='/blog'>← back to blog</a>
        </div>
    </div>

<h2 class="article-title">Analysing the NYT Best Sellers list using an API</h2>
<div id="doc">
    <div class="hanging-subtitle">
        
                
        
            
                <p>17 September 2023</p>
            
        
    </div>
<div class="sidenote"  style="padding-top: 10em;">REST: represen-<br>tational state transfer</div>
<p>Using an API (an <em>application programming interface</em>) is a very popular tool for data scientists to pull data from a public source. I&rsquo;ve done a bit of web scraping in previous blogposts where I collected data from for example <a href="https://danielroelfs.com/blog/the-easier-way-to-create-a-map-of-norway-using-csmaps/">Wikipedia</a> and the <a href="https://danielroelfs.com/blog/dutch-performance-at-olympic-speed-skating/">Olympian Database</a>. However, I&rsquo;d much prefer using APIs whenever possible, this way the creator has more control of what data they want to share and how it is packaged. The most common APIs use a <a href="https://aws.amazon.com/what-is/restful-api/#:~:text=RESTful%20API%20is%20an%20interface,applications%20to%20perform%20various%20tasks.">RESTful</a> approach where the interface and communication between you and the server the data is stored on follows a predictable approach and maintains some common standards. Most RESTful APIs return data in JSON format. In this blogpost I want to show you a simple way to interact with a RESTful API through Python and of course we&rsquo;ll do some analyses on the data we collect.</p>
<p>The API we will be working with here is the <a href="https://developer.nytimes.com/docs/books-product/1/overview">New York Times Books API</a>. This API provides us with access to the current and previous (up to 2008) New York Times Best Sellers lists. It allows ut to download each individual list (both fiction, non-fiction, children&rsquo;s, etc), including ones that are no longer updated (such as the monthly lists on Espionage and Love &amp; Relationships). Let&rsquo;s keep it simple for now and only focus on the main list on fiction, called the <a href="https://www.nytimes.com/books/best-sellers/">Combined Print &amp; E-Book Fiction</a> list which appears as the list on the home page of the Best Sellers webpage.</p>
<p>Let&rsquo;s first setup our Python environment. We&rsquo;ll use <code>pandas</code> to store the results for easy data wrangling and the <code>numpy</code> module to get access to the <code>np.nan</code> functionality to denote missing values. The <code>requests</code> module deals with the the API calls to the server. We&rsquo;ll get into that. Since the NYT APIs require a personal API key (a key I don&rsquo;t want to share on the internet), I&rsquo;ll store my API key in a &ldquo;secrets&rdquo; file, in this case a <code>.secrets.yml</code> <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> file that easily stores these kinds of data. If you&rsquo;re not familiar with YAML, it&rsquo;s the same format that Hugo, RMarkdown, and Quarto documents use to define settings and parameters. To parse YAML files, we can use the <code>yaml</code> module. We&rsquo;ll also be dealing with a few date formats, so I&rsquo;ll import a few items from the <code>datetime</code> module. Finally, we&rsquo;ll load the <code>time</code> module. Many APIs are &ldquo;rate limited&rdquo; to avoid users from submitting too many requests in a short amount of time and clogging up the server. The <code>time</code> module has a <code>sleep()</code> function that lets us wait a given number of seconds before proceding. This way we can avoid exceeding the API rate limit and interrupting the data collection.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span></code></pre></div><p>So in proper Python fashion, we&rsquo;ll encapsulate the functions as much as possible. The NYT Books API lets us download historical versions of the Best Seller lists. Therefore, we need first to get a list of dates that we can use for our API request. For this we&rsquo;ll make a simple function that takes the start and end date of the timeframe of interest which we can set by default to provide a list going back 52 weeks from today. As well as the frequency (so that we can more easily and quickly download monthly lists if we wanted to). The exact date Best Seller list was released is not important since the API will return the latest list at the requested date. To generate the date list we&rsquo;ll use a simple <code>pd.date_range()</code> function, and we&rsquo;ll format them in a default string format using a list comprehension and the <code>strftime()</code> function from the <code>datetime</code> module.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_list_of_dates</span>(
</span></span><span style="display:flex;"><span>    start<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>today() <span style="color:#f92672">-</span> timedelta(weeks<span style="color:#f92672">=</span><span style="color:#ae81ff">52</span>), 
</span></span><span style="display:flex;"><span>    end<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>today(), 
</span></span><span style="display:flex;"><span>    frequency<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;W&#34;</span>
</span></span><span style="display:flex;"><span>  ):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Generate a list of dates
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  date_list <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>date_range(start, end, freq<span style="color:#f92672">=</span>frequency)
</span></span><span style="display:flex;"><span>  date_list_str <span style="color:#f92672">=</span> [x<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> date_list]
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> date_list_str
</span></span></code></pre></div><p>Now that we have a function that will provide a list of dates, the next ingredient we need is the API key. The NYT Books API requires a personal API key to authenticate your request. Since this key is personal I won&rsquo;t upload it the internet, but instead I stored it in a <code>.secrets.yml</code> file that I put in my <code>.gitignore</code> file to avoid storing it in Git log. We&rsquo;ll use the functionality from the <code>yaml</code> module to parse the file. The function will return the API key as a string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_api_key</span>(path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./.secrets.yml&#34;</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Get the API key from the secrets file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">with</span> open(path, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> stream:
</span></span><span style="display:flex;"><span>    secrets <span style="color:#f92672">=</span> yaml<span style="color:#f92672">.</span>safe_load(stream)
</span></span><span style="display:flex;"><span>  nyt_api_key <span style="color:#f92672">=</span> secrets[<span style="color:#e6db74">&#34;API&#34;</span>][<span style="color:#e6db74">&#34;NYT&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> nyt_api_key
</span></span></code></pre></div><p>Now we&rsquo;re ready to generate a single API query. To obtain the list we&rsquo;re interested in, we can follow the template laid out on the <a href="https://developer.nytimes.com/docs/books-product/1/routes/lists/%7Bdate%7D/%7Blist%7D.json/get">NYT Books API documentation</a>. The request starts with a base url (in this case <code>https://api.nytimes.com/svc/books/v3</code>). Then we&rsquo;ll specify both the date and list type, both of which are defined in the input arguments to the <code>generate_request()</code> function. By default we request the &ldquo;fiction&rdquo; list (that defaults to the <code>combined-print-and-e-book-fiction</code> list), providing &ldquo;non-fiction&rdquo; as input to this argument would default to the <code>combined-print-and-e-book-nonfiction</code> list. Any other list needs to use the specific name (we&rsquo;ll get back to that later). Finally, we use the <code>_get_api_key()</code> function we defined earlier to get the last parameter we need to the finalize the query.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_request</span>(list<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fiction&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current&#34;</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Generate the API request url
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  base <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.nytimes.com/svc/books/v3&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> list <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;fiction&#34;</span>:
</span></span><span style="display:flex;"><span>      list_spec <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/lists/</span><span style="color:#e6db74">{</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74">/combined-print-and-e-book-fiction.json&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">elif</span> list <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;non-fiction&#34;</span>:
</span></span><span style="display:flex;"><span>      list_spec <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/lists/</span><span style="color:#e6db74">{</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74">/combined-print-and-e-book-nonfiction.json&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>      list_spec <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/lists/</span><span style="color:#e6db74">{</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>list<span style="color:#e6db74">}</span><span style="color:#e6db74">.json&#34;</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>  nyt_api_key <span style="color:#f92672">=</span> _get_api_key()
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  api_url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>base<span style="color:#e6db74">}{</span>list_spec<span style="color:#e6db74">}</span><span style="color:#e6db74">?api-key=</span><span style="color:#e6db74">{</span>nyt_api_key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> api_url
</span></span></code></pre></div><p>Now we get to the part where we actually download some data using the functions we created earlier. We can again define the list we&rsquo;re interested in and the date in the input arguments to this function. These will trickle down to the lower level functions. We first generate the URL by using the <code>generate_request()</code> function. Then we&rsquo;ll use the <code>requests</code> module to obtain the response from the server and get the returned data in a JSON format. The JSON contains a bunch of information, but we&rsquo;re mostly interested in the <code>books</code> part that actually lists the books in order of appearance on the specified list on the specified date. One of the other information that is not in the <code>books</code> field is the <code>published_date</code> field that shows when the list was last updated. We can parse this date so we can include it in the data frame that will be returned in the end. The <code>books</code> field contains some information is not particularly interesting (like the size of the book cover and the buy links shown on the NYT website).</p>
<p>We&rsquo;ll parse some the data, i.e. make the <code>&quot;title&quot;</code> field title-case, replace zeroes that denote that a book wasn&rsquo;t in the list with <code>np.nan</code>, calculate the difference in ranking between each week, and add the date the list was published. Finally we&rsquo;ll reorder the columns and return a data frame.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">api_request</span>(list<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fiction&#34;</span>, date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;current&#34;</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Extract the data from the API
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  url <span style="color:#f92672">=</span> generate_request(list<span style="color:#f92672">=</span>list, date<span style="color:#f92672">=</span>date)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)
</span></span><span style="display:flex;"><span>  json_raw <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  nyt_list_json <span style="color:#f92672">=</span> json_raw[<span style="color:#e6db74">&#34;results&#34;</span>][<span style="color:#e6db74">&#34;books&#34;</span>]
</span></span><span style="display:flex;"><span>  list_publish_date <span style="color:#f92672">=</span> json_raw[<span style="color:#e6db74">&#34;results&#34;</span>][<span style="color:#e6db74">&#34;published_date&#34;</span>]
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  df_all <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()<span style="color:#f92672">.</span>from_dict(nyt_list_json)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  cols_to_drop <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;book_image&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;book_image_width&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;book_image_height&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;isbns&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;buy_links&#34;</span>,
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  df <span style="color:#f92672">=</span> df_all<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>cols_to_drop)<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>  df[<span style="color:#e6db74">&#34;title&#34;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;title&#34;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>title()
</span></span><span style="display:flex;"><span>  df[<span style="color:#e6db74">&#34;rank_last_week&#34;</span>]<span style="color:#f92672">.</span>replace({<span style="color:#ae81ff">0</span>: np<span style="color:#f92672">.</span>nan}, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>  df[<span style="color:#e6db74">&#34;list_publication_date&#34;</span>] <span style="color:#f92672">=</span> list_publish_date
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  df_out <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#34;rank&#34;</span>, <span style="color:#e6db74">&#34;rank_last_week&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span>, <span style="color:#e6db74">&#34;author&#34;</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;weeks_on_list&#34;</span>, <span style="color:#e6db74">&#34;list_publication_date&#34;</span>]]<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> df_out
</span></span></code></pre></div><div class="sidenote"  style="padding-top: 12em;">Given these limits, you can deduce how long it takes to download data for a few years. It&rsquo;s quite a while&hellip;</div>
<p>Now, each of the functions above dealt with performing a single API request. Since we are interested in obtaining an historical dataset, we should run the API request for each of the weeks we returned in the <code>get_list_of_dates()</code> function. In the <code>download_bestseller_lists()</code> function, we&rsquo;ll first get the list of dates. Then we&rsquo;ll loop through the list of dates going back roughly 5 years. In each iteration we&rsquo;ll run the <code>api_request()</code> function for the specified date and concatenate the result with the existing data frame. Then, in order to avoid hitting the API rate limit we&rsquo;ll wait for 12 seconds, the NYT Books API is rate limited at 500 requests per day and 5 requests per minute so we need to wait 12 seconds between each request to avoid hitting the rate limit. Finally, we&rsquo;ll run this <code>download_bestseller_lists()</code> function for the Fiction list, and save the output in a CSV file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">download_bestseller_lists</span>(
</span></span><span style="display:flex;"><span>      list_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fiction&#34;</span>, 
</span></span><span style="display:flex;"><span>      start_date<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>today() <span style="color:#f92672">-</span> timedelta(weeks<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">52</span>), 
</span></span><span style="display:flex;"><span>      end_date<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>today(),
</span></span><span style="display:flex;"><span>      save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>      return_df<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>  ):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Download the Best Seller list from a given date
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  date_list <span style="color:#f92672">=</span> get_list_of_dates(start<span style="color:#f92672">=</span>start_date, end<span style="color:#f92672">=</span>end_date)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  n_dates <span style="color:#f92672">=</span> len(date_list)
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Number of requests: </span><span style="color:#e6db74">{</span>n_dates<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Estimated download time: </span><span style="color:#e6db74">{</span>n_dates <span style="color:#f92672">*</span> <span style="color:#ae81ff">12</span><span style="color:#e6db74">}</span><span style="color:#e6db74">s or </span><span style="color:#e6db74">{</span>n_dates <span style="color:#f92672">*</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">60</span><span style="color:#e6db74">}</span><span style="color:#e6db74">min&#34;</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  df_nyt_list <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> date_list:
</span></span><span style="display:flex;"><span>      print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Extracting </span><span style="color:#e6db74">{</span>list_type<span style="color:#e6db74">}</span><span style="color:#e6db74"> list at date </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>      df_nyt_list <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df_nyt_list, api_request(list<span style="color:#f92672">=</span>list_type, date<span style="color:#f92672">=</span>i)])
</span></span><span style="display:flex;"><span>      time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>    df_nyt_list<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;./data/nyt_list_</span><span style="color:#e6db74">{</span>list_type<span style="color:#e6db74">}</span><span style="color:#e6db74">.csv&#34;</span>, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> return_df:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> df_nyt_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>download_bestseller_lists(list_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fiction&#34;</span>)
</span></span></code></pre></div><p>Now that we&rsquo;ve done the hard work in Python, let&rsquo;s do some data visualization in R using <code>ggplot</code> and a few other <code>{tidyverse}</code> and plotting related packages (<code>{ggtext}</code> and <code>{patchwork}</code>). Since the <code>download_bestseller_lists()</code> function in Python also saved the file, we can easily load it into R. Since I&rsquo;m using the <code>{reticulate}</code> package to create this, I could have also used the <code>py$&lt;variable name&gt;</code> functionality, but since the API call takes a lot of time to run, this seemed easier.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;./data/nyt_list_fiction.csv&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">glimpse</span>()
</span></span></code></pre></div><pre><code>Rows: 3900 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
chr  (2): title, author
dbl  (3): rank, rank_last_week, weeks_on_list
date (1): list_publication_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Rows: 3,900
Columns: 6
$ rank                  &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
$ rank_last_week        &lt;dbl&gt; NA, NA, NA, 5, 1, 4, 8, NA, 10, NA, 3, NA, 9, NA…
$ title                 &lt;chr&gt; &quot;Vince Flynn: Red War&quot;, &quot;An Absolutely Remarkabl…
$ author                &lt;chr&gt; &quot;Kyle Mills&quot;, &quot;Hank Green&quot;, &quot;Kate Atkinson&quot;, &quot;Ke…
$ weeks_on_list         &lt;dbl&gt; 1, 1, 1, 16, 2, 3, 3, 1, 4, 1, 31, 15, 8, 1, 7, …
$ list_publication_date &lt;date&gt; 2018-10-14, 2018-10-14, 2018-10-14, 2018-10-14,…
</code></pre>
<p>As mentioned, the dataset we downloaded does not include all history of the Best Sellers list due to the API rate limit. Instead we specified that we want to look about 5 years back, let&rsquo;s see what the earliest to latest dates in the dataset are.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">summarise</span>(
</span></span><span style="display:flex;"><span>    from <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(list_publication_date),
</span></span><span style="display:flex;"><span>    to <span style="color:#f92672">=</span> <span style="color:#a6e22e">max</span>(list_publication_date)
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div><pre><code># A tibble: 1 × 2
  from       to        
  &lt;date&gt;     &lt;date&gt;    
1 2018-10-14 2023-10-01
</code></pre>
<p>The purpose of this post is mostly to show the implementation of an API call in Python, but I want to make some plots anyway because it&rsquo;s fun. Let&rsquo;s first look at what book has spend the longest on the Best Sellers list. Just to make it easier to determine the book, we&rsquo;ll create a composite variable of both the book author and title before plotting and take the 20 books that have the most occurences on the list using the <code>count()</code> function and then use the <code>slice_max()</code> to limit the dataset to 20.</p>
<details>
<summary>Code for the plot below</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span>(author, title, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n_weeks_on_list&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mutate</span>(book_label <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;{author} - {title}&#34;</span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">slice_max</span>(order_by <span style="color:#f92672">=</span> n_weeks_on_list, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> n_weeks_on_list, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">reorder</span>(book_label, n_weeks_on_list))) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_col</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#5D7B92&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_text</span>(<span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> n_weeks_on_list),
</span></span><span style="display:flex;"><span>    nudge_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">-7</span>,
</span></span><span style="display:flex;"><span>    color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, linewidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>    title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Which books have spent the longest&lt;br&gt;on the NYT Best Sellers list?&#34;</span>,
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_x_continuous</span>(
</span></span><span style="display:flex;"><span>    position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>,
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> <span style="color:#f92672">~</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;{.x} wk&#34;</span>),
</span></span><span style="display:flex;"><span>    expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expansion</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>))
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    plot.title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plot&#34;</span>,
</span></span><span style="display:flex;"><span>    plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div></details>
<img src="index.markdown_strict_files/figure-markdown_strict/plot-top-weeks-1.png" width="768" />
<p>It looks like <em>Where The Crawdads Sing</em> by Delia Owens has appeared a total of 193 times on the list in the past 5 years. The number two (<em>It Ends With Us</em>) follows with 115 weeks, but after inspection of the data that book is currently in the list, so may yet make up some ground.</p>
<p>Let&rsquo;s also look at which authors have had the largest number of books in the list in the past 5 years using roughly the same approach.</p>
<details>
<summary>Code for the plot below</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">distinct</span>(author, title) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span>(author, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;n_books_in_list&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">slice_max</span>(order_by <span style="color:#f92672">=</span> n_books_in_list, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> n_books_in_list, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">reorder</span>(author, n_books_in_list))) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_col</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#5D7B92&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_text</span>(<span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> n_books_in_list),
</span></span><span style="display:flex;"><span>    nudge_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1</span>,
</span></span><span style="display:flex;"><span>    color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, linewidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>    title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Which authors have the most books&lt;br&gt;on the NYT Best Sellers list?&#34;</span>,
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_x_continuous</span>(
</span></span><span style="display:flex;"><span>    position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>,
</span></span><span style="display:flex;"><span>    labels <span style="color:#f92672">=</span> <span style="color:#f92672">~</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;{.x} books&#34;</span>),
</span></span><span style="display:flex;"><span>    expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expansion</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    plot.title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plot&#34;</span>,
</span></span><span style="display:flex;"><span>    plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.grid.major.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div></details>
<img src="index.markdown_strict_files/figure-markdown_strict/plot-top-authors-1.png" width="768" />
<div class="sidenote"  style="padding-top: 8em;">The LA Review of Books even used the term <a href="https://lareviewofbooks.org/article/the-sublime-danielle-steel/">&ldquo;supermarket schlock&rdquo;</a></div>
<p>This genuinely surprised me, I had expected some authors to have maybe 6 or 7 books on the list, but it turns out there are some really prolific authors out there, with Danielle Steel definitely taking the top spot. According to her separate (!) <a href="https://en.wikipedia.org/wiki/Danielle_Steel_bibliography">bibliography page on Wikipedia</a> she publishes several books a year to make a total of 190 published books, including 141 novels. Wikipedia also mentions a <a href="https://www.publishersweekly.com/978-0-312-11257-8">&ldquo;resounding lack of critical acclaim&rdquo;</a>, which just emphasizes the point that the New York Times Best Sellers list is not necessarily a mark of quality, but rather of popularity, although one would hope good books are also the books that sell well. Note that some authors have received critical acclaim <em>and</em> have published multiple popular books such as Colleen Hoover and Stephen King in the plot above.</p>
<p>Since we have essentially time series data, we could also plot the trajectory of a book. So let&rsquo;s take the book that spent the longest on the Best Sellers list in our timeframe: <em>Where The Crawdads Sing</em>. We can plot rank on the list over time. We&rsquo;ll use the <code>geom_bump()</code> function from the <code>{ggbump}</code> package to get a nicer-looking curve. Since <code>geom_path()</code> and <code>geom_bump()</code> will show a continuous line for missing values and dropping those empty values looks ugly, we&rsquo;ll hide the weeks where the book wasn&rsquo;t on the Best Sellers list in an area below the plot.</p>
<details>
<summary>Code for the plot below</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>title_of_interest <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;Where The Crawdads Sing&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">filter</span>(title <span style="color:#f92672">==</span> title_of_interest) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">right_join</span>(data <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">select</span>(list_publication_date) <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">distinct</span>(),
</span></span><span style="display:flex;"><span>    by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list_publication_date&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">replace_na</span>(<span style="color:#a6e22e">list</span>(rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> list_publication_date, y <span style="color:#f92672">=</span> rank)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_hline</span>(yintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  ggbump<span style="color:#f92672">::</span><span style="color:#a6e22e">geom_bump</span>(linewidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#5D7B92&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_rect</span>(<span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>    xmin <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(data<span style="color:#f92672">$</span>list_publication_date),
</span></span><span style="display:flex;"><span>    xmax <span style="color:#f92672">=</span> <span style="color:#a6e22e">max</span>(data<span style="color:#f92672">$</span>list_publication_date),
</span></span><span style="display:flex;"><span>    ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">15.2</span>, ymax <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>
</span></span><span style="display:flex;"><span>  ), fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey40&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_text</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(), <span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(data<span style="color:#f92672">$</span>list_publication_date), y <span style="color:#f92672">=</span> <span style="color:#ae81ff">15.75</span>,
</span></span><span style="display:flex;"><span>    label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Not on list&#34;</span>
</span></span><span style="display:flex;"><span>  ), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>    title <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;How _{title_of_interest}_ ranked over time&#34;</span>),
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Position on Best Sellers list&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_y_continuous</span>(
</span></span><span style="display:flex;"><span>    trans <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reverse&#34;</span>,
</span></span><span style="display:flex;"><span>    breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>    expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expansion</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">coord_cartesian</span>(clip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;off&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>    plot.title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plot&#34;</span>,
</span></span><span style="display:flex;"><span>    plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(
</span></span><span style="display:flex;"><span>      size <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>,
</span></span><span style="display:flex;"><span>      padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(b <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    panel.grid.minor.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
</span></span><span style="display:flex;"><span>  )
</span></span></code></pre></div></details>
<img src="index.markdown_strict_files/figure-markdown_strict/plot-trajectory-1.png" width="768" />
<p>That is quite an impressive trajectory. There are a few moments where the book leaves the Best Sellers list, but it had a spot on the list every year from 2018 when the book was published to 2023.</p>
<div class="sidenote"  style="padding-top: 18em;">Sally Rooney actually has <a href="https://www.imdb.com/name/nm10745607/?ref_=nv_sr_srsg_0_tt_0_nm_8_q_sally%2520roon">writing credits</a> on the series too!</div>
<p>The jump in the plot above that happens in 2022 seemed very remarkable, jumping from spot 13 to 1 within a week. I was wondering if that had anything to do with the release of the movie adaptation. So let&rsquo;s have a look. The movie was released on July 15th, 2022. Let&rsquo;s also look at a few other books I know were on the Best Sellers list that have gotten an adaptation. This is just anecdotal and hand-picked evidence of course so needs to be taken with a grain of salt. Perhaps another time I&rsquo;ll find a more systematic way of testing this. In addition to <a href="https://www.imdb.com/title/tt9411972/"><em>Where The Crawdads Sing</em></a>, I&rsquo;ve picked two other movies and three TV series. The other two movies are <a href="https://www.imdb.com/title/tt2737304/"><em>Bird Box</em></a> released in late 2018 and <a href="https://www.imdb.com/title/tt7349950/"><em>It Chapter Two</em></a>, the second installment of the adaptation of <em>It</em> by Stephen King. For the TV series I&rsquo;ll look at the wonderful <a href="https://www.imdb.com/title/tt9059760/"><em>Normal People</em></a> based on the novel by Sally Rooney, initially released in 2020, <a href="https://www.imdb.com/title/tt8550800/"><em>The Outsider</em></a> also based on a book by Stephen King, and <a href="https://www.imdb.com/title/tt5834204/"><em>The Handmaid&rsquo;s Tale</em></a> based on the book by Margaret Atwood. In the plots below the vertical dashed line indicates the release date of the adaptation.</p>
<details>
<summary>Code for the plot below</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>titles_w_adaptation <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tribble</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">~</span>title, <span style="color:#f92672">~</span>screen_release_date,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Where The Crawdads Sing&#34;</span>, <span style="color:#e6db74">&#34;2022-07-15&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Bird Box&#34;</span>, <span style="color:#e6db74">&#34;2018-12-14&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;It&#34;</span>, <span style="color:#e6db74">&#34;2019-09-06&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Normal People&#34;</span>, <span style="color:#e6db74">&#34;2020-04-26&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;The Outsider&#34;</span>, <span style="color:#e6db74">&#34;2020-01-06&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;The Handmaid&#39;S Tale&#34;</span>, <span style="color:#e6db74">&#34;2019-6-5&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rplot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (i <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">seq_len</span>(<span style="color:#a6e22e">nrow</span>(titles_w_adaptation))) {
</span></span><span style="display:flex;"><span>  book_title <span style="color:#f92672">&lt;-</span> titles_w_adaptation <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">slice</span>(i) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mutate</span>(title <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(title, <span style="color:#e6db74">&#34;&#39;S&#34;</span>, <span style="color:#e6db74">&#34;&#39;s&#34;</span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pull</span>(title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  rplot[[i]] <span style="color:#f92672">&lt;-</span> data <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">right_join</span>(titles_w_adaptation <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#a6e22e">slice</span>(i), by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;title&#34;</span>) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">right_join</span>(data <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">select</span>(list_publication_date) <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">distinct</span>(),
</span></span><span style="display:flex;"><span>      by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list_publication_date&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">replace_na</span>(<span style="color:#a6e22e">list</span>(rank <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>)) <span style="color:#f92672">|&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> list_publication_date, y <span style="color:#f92672">=</span> rank)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_hline</span>(yintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    ggbump<span style="color:#f92672">::</span><span style="color:#a6e22e">geom_bump</span>(linewidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_rect</span>(<span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>      xmin <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(data<span style="color:#f92672">$</span>list_publication_date),
</span></span><span style="display:flex;"><span>      xmax <span style="color:#f92672">=</span> <span style="color:#a6e22e">max</span>(data<span style="color:#f92672">$</span>list_publication_date),
</span></span><span style="display:flex;"><span>      ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">15.2</span>, ymax <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>
</span></span><span style="display:flex;"><span>    ), fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey40&#34;</span>, show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(), <span style="color:#a6e22e">aes</span>(
</span></span><span style="display:flex;"><span>      x <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(data<span style="color:#f92672">$</span>list_publication_date), y <span style="color:#f92672">=</span> <span style="color:#ae81ff">15.75</span>,
</span></span><span style="display:flex;"><span>      label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Not on list&#34;</span>
</span></span><span style="display:flex;"><span>    ), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(<span style="color:#a6e22e">aes</span>(xintercept <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.Date</span>(screen_release_date)),
</span></span><span style="display:flex;"><span>      linewidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(
</span></span><span style="display:flex;"><span>      title <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_glue</span>(<span style="color:#e6db74">&#34;Ranking of _{book_title}_&#34;</span>),
</span></span><span style="display:flex;"><span>      x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>      y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rank on list&#34;</span>,
</span></span><span style="display:flex;"><span>      color <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scale_y_continuous</span>(
</span></span><span style="display:flex;"><span>      trans <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reverse&#34;</span>,
</span></span><span style="display:flex;"><span>      breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>      expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">expansion</span>(add <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">coord_cartesian</span>(clip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;off&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>(
</span></span><span style="display:flex;"><span>      plot.title.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plot&#34;</span>,
</span></span><span style="display:flex;"><span>      plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(
</span></span><span style="display:flex;"><span>        size <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>,
</span></span><span style="display:flex;"><span>        padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">margin</span>(b <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>      ),
</span></span><span style="display:flex;"><span>      panel.grid.minor.y <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
</span></span><span style="display:flex;"><span>      legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
</span></span><span style="display:flex;"><span>      legend.direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vertical&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(rplot[[1]] <span style="color:#f92672">+</span> rplot[[2]]) <span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  (rplot[[3]] <span style="color:#f92672">+</span> rplot[[4]]) <span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span>  (rplot[[5]] <span style="color:#f92672">+</span> rplot[[6]]) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plot_annotation</span>(
</span></span><span style="display:flex;"><span>    caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Vertical dashed line indicates the adaptation&#39;s release date&#34;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">&amp;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>(plot.caption <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_markdown</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>))
</span></span></code></pre></div></details>
<img src="index.markdown_strict_files/figure-markdown_strict/plot-trajectory-adaptations-1.png" width="768" />
<p>It seems that for <em>Where The Crawdads Sing</em>, the movie release ensured that the book remained at number 1 on the Best Sellers list for a while, even though the book was already doing very well in the list before the movie release. For both <em>Bird Box</em> and <em>It</em> their movie releases seemed to have caused a boost in sales of the book that made them reappear in the list for a short time. I&rsquo;d guess the fact that the book <em>Where The Crawdads Sing</em> was already very popular prior to the movie release caused a boost in popularity that lingered longer. Both <em>Bird Box</em> and <em>It</em> had a brief reappearance in the list following their movie release, but I&rsquo;d guess that a publisher cannot rely on a successful movie release (like <em>Bird Box</em> or <em>It</em>) to boost the sales of a book. It cannot compensate for the success of an already popular and well-received book like <em>Where The Crawdads Sing</em>.</p>
<p>For the TV series I looked at, the pattern looks very similar to the previous two movies. The book <em>Normal People</em> had already appeared briefly on the Best Sellers list, but reappeared after the initial release of the popular HBO series for slightly longer. The same is true for both <em>The Outsider</em> and <em>The Handmaid&rsquo;s Tale</em>. Although <em>The Handmaid&rsquo;s Tale</em> was initially published in 1985, it reappeared briefly in the list following the release of the third season of the HBO series. <em>The Outsider</em> was initially published in 2018, and it&rsquo;s series adaptation release in early 2020 cause a short boost in popularity also.</p>
<p>This was a fun little post, I hope this little tutorial on the practical implementation of an API call was useful. If you want to explore other lists other than the &ldquo;Combined Print and E-Book Fiction&rdquo; list, the code below shows how you can download all lists available in the API using a similar approach as above.</p>
<details>
<summary>Code to download a list of all lists available in the NYT API</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_nyt_lists</span>(save<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, return_df<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Get an overview of all best-seller lists
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://api.nytimes.com/svc/books/v3/lists/names.json?api-key=</span><span style="color:#e6db74">{</span>_get_api_key()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  json_raw <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>  list_names <span style="color:#f92672">=</span> json_raw[<span style="color:#e6db74">&#34;results&#34;</span>]
</span></span><span style="display:flex;"><span>  df_names <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()<span style="color:#f92672">.</span>from_dict(list_names)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> save:
</span></span><span style="display:flex;"><span>    df_names<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;./data/nyt_all_lists.csv&#34;</span>, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> return_df:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> df_names
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_nyt_lists()
</span></span></code></pre></div></details>
<p>If you wish to explore other APIs, there&rsquo;s <a href="https://github.com/public-apis/public-apis">a ton of public APIs</a> that you can explore using the approach discussed here. Thanks for reading, and thanks sticking all the way through! Happy coding!</p>

</div>

        </div>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/foundation.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
<script>
  hljs.highlightAll();
</script>


<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
  MathJax = {
      tex: {
        inlineMath: [ ['$','$'] ]
      }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>


<script src="https://unpkg.com/feather-icons"></script>
<script>
  feather.replace()
</script>

<div id="nav-border" class="container">
    
    <div class="nav-outer">
        <div class="nav-inner">
            
                
                    
                        <a class="internal" hyphens="none" href="/">
                            
                            Home
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/blog">
                            
                            Blog
                        </a>
                    
                
                    
                
                    
                        <a class="internal" hyphens="none" href="/publications">
                            
                            Publications
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/cv">
                            
                            CV
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/about">
                            
                            About
                        </a>
                    
                
            
        </div>
    </div>
    
</div>

</body>
</html>
